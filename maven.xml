<project
	default="test"
  xmlns:define="jelly:define"
	xmlns:ant="jelly:ant"
	xmlns:doc="doc"
  xmlns:j="jelly:core"  
  xmlns:jxr="jxr"
  xmlns:maven="jelly:maven"
  xmlns:util="jelly:util">

<!--
	<define:taglib uri="jxr">
		<define:jellybean
			name="jxr"
			className="org.apache.maven.jxr.JxrBean"
			method="xref" />
	</define:taglib>
-->

	<preGoal name="java:compile">
		<ant:path id="my.other.src.dir" location="${basedir}/src/examples"/>
		<maven:addPath id="maven.compile.src.set" refid="my.other.src.dir"/>
	</preGoal>

	<postGoal name="maven-javadoc-plugin:register">
		<doc:registerReport 
			name="Example JavaDocs" 
			pluginName="maven-javadoc-plugin"
			link="apidocs-examples/index"
			target="_blank"
			description="Example JavaDoc API documentation."/>
	</postGoal>

	<postGoal name="maven-javadoc-plugin:report">
		<ant:copy todir="${basedir}/target/javadoc/src">
			<ant:fileset dir="${basedir}/src/examples">
				<ant:include name="**/*.java" />
				<ant:include name="**/doc-files/**/*" />
			</ant:fileset>
		</ant:copy>
		<ant:javadoc
			packagenames="org.apache.mina.examples.*"
			sourcepath="${basedir}/src/examples"
			destdir="${maven.docs.dest}/apidocs-examples" />
	</postGoal>
	<postGoal name="maven-jxr-plugin:register">
		<doc:registerReport 
			name="Examples Xref" 
			pluginName="maven-jxr-plugin" 
			link="xref-examples/index"
			target="_blank"
			description="A set of browsable cross-referenced example sources."/>
	</postGoal>
	
	<postGoal name="maven-jxr-plugin:report">
		<maven:pluginVar var="javadocDestdir" plugin='maven-javadoc-plugin' property='maven.javadoc.destdir'/>
		<maven:pluginVar var="stylesheetPath" plugin='maven-jxr-plugin' property='maven.jxr.stylesheet'/>
		<maven:pluginVar var="templatePath" plugin='maven-jxr-plugin' property='maven.jxr.templateDir'/>

		<j:set var="maven.jxr.destdir.examples"
			value="${maven.docs.dest}/xref-examples" />

		<j:set var="copyright"
			value="Copyright &amp;copy; ${year} ${pom.organization.name}. All Rights Reserved." />

		<j:set var="title" value="${pom.name} ${pom.currentVersion} Reference" />

		<ant:mkdir dir="${maven.jxr.destdir.examples}" />
		<ant:copy file="${stylesheetPath}"
			tofile="${maven.jxr.destdir.examples}/stylesheet.css"/>

		<jxr:jxr
			sourceDir="${basedir}/src/examples"
			destDir="${maven.jxr.destdir.examples}"
			templateDir="${templatePath}"
			javadocDir="${javadocDestdir}"
			windowTitle="${title}"
			docTitle="${title}"
			bottom="${copyright}">
		</jxr:jxr>
	</postGoal>

	<preGoal name="dist:build-src">
		<ant:copy todir="${maven.dist.src.assembly.dir}">
			<ant:fileset dir=".">
				<ant:include name="xdocs/**"/>
			</ant:fileset>
		</ant:copy>
	</preGoal>

	<preGoal name="dist:build-bin">
		<attainGoal name="site"/>
	</preGoal>

</project>
